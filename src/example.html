<body>
	<pre>Hint: open your browser console to see the magic (F12)!</pre>
	
	<script src="com.fiskaly.kassensichv.sma-web.js"></script>
	
	<script>
		const apiKey = 'TODO INSERT YOUR API KEY HERE'
		const apiSecret = 'TODO INSERT YOUR API SECRET HERE'

		main().catch(console.error)

		async function main() {
			const smaVersion = await com.fiskaly.kassensichv.sma.invoke('version')
			console.log('Checking SMA version...', smaVersion)
			if (/TODO/.test(apiKey) || /TODO/.test(apiSecret)) {
				throw new Error('Insert your apiKey and/or apiSecrets first')
			}
			const client = com.fiskaly.kassensichv.client(apiKey, apiSecret)
			const clientList = await client({ path: '/client' })
			const firstClient = clientList.body.data[0]
			if (firstClient == null) {
				throw new Error('Create a client and TSS in the dashboard first')
			}
			const clientId = firstClient._id
			const tssId = firstClient.tss_id
			console.log('Choosing first available TSS...', tssId)
			console.log('Choosing first available Client...', clientId)
			const txId = uuidv4()
			const txBody = {
				state: 'ACTIVE',
				type: 'OTHER',
				client_id: clientId,
				data: {
					aeao: {
						other: {}
					}
				}
			}
			const txPath = `/tss/${tssId}/tx/${txId}`
			const tx = await client({
				method: 'PUT',
				path: txPath,
				body: txBody
			})
			console.log('Started Transaction...', tx.body)
			console.log(`See Transaction in the Dashboard: https://dashboard.fiskaly.com/kassensichv${txPath}`)
		}

		function uuidv4() {
			return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>
				(c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
			)
		}
	</script>
</body>
